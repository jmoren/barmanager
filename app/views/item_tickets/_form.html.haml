%h4.ui.header Agregar Items
= form_for [ticket, ticket.item_tickets.new], html: { class: "form ui item-form"} do |f|
  .ui.grid
    .four.wide.column.field
      .ui.left.icon.input
        %i.icon.search
        %input{type: "text", name: "code_number", placeholder: "Cod", focus: true, autocomplete: "off"}
    .four.wide.column.field
      = f.number_field :quantity, placeholder: "Cant", min: "1"
    .eight.wide.column.field
      .ui.fluid.search.selection.dropdown.combo
        = f.hidden_field :item_id
        %i.dropdown.icon
        .default.text Seleccione Item
        .menu
          - Item.all.each do |item|
            .item{ data: { value: item.id, code: item.code } }
              = item.description

  .ui.red.message.item-code{style: "display:none"}
    No se encontro ningun item

:javascript
  $(document).ready(function(){

    $('.item-form .dropdown').dropdown({
      onChange: function (val,text,elm) {
        $('.item-form input[name=code_number]').val(elm.attr('data-code'));
        $("#item_ticket_item_id").val(val);
      }
    });

    $(".item-form input[name=code_number]").on("keyup", function(){
      val = $(this).val();
      if(val.length >= 1){
        $.ajax({
          url: "/items?code=" + val,
          dataType: "JSON",
          method: "GET",
          success: function(res){
            if(res.id !== null){
              $(".item-form .dropdown").dropdown("set selected", res.id);
              $("#item_ticket_item_id").val(res.id);
              $(".item-code").hide();
            }else{
              $(".item-code").show();
            }
          }
        })
      }
    });

    $('.item-form').form({
      item_id: {
        identifier: 'item_ticket_item_id',
        rules: [{ type   : 'empty' }]
      },
      quantity: {
        identifier: 'item_ticket_quantity',
        rules: [{ type   : 'empty' }, { type: 'not[0]' }]
      }
    },{
      onError: function() {
        $('#item_ticket_quantity').focus();
      }
    })
  })
